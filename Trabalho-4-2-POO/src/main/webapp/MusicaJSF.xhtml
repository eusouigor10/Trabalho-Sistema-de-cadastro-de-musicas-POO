<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets"
                template="template.xhtml">

    <ui:define name="title">Gerenciamento de MÃºsicas</ui:define>

    <ui:define name="content">

        <style>
            .page-title {
                font-size: 2.2rem;
                font-weight: bold;
                margin-bottom: 20px;
                color: #2c3e50;
                text-align: center;
            }

            .btn-primary {
                background-color: #3498db;
                color: white;
                padding: 10px 18px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                transition: 0.3s;
            }
            .btn-primary:hover {
                background-color: #2980b9;
            }

            .warning-box {
                background: #ffefc6;
                border-left: 6px solid #f1c40f;
                padding: 15px;
                margin: 20px 0;
                border-radius: 8px;
                color: #745e00;
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 1.4rem;
                margin-top: 30px;
                color: #34495e;
            }

            .search-grid {
                margin-top: 10px;
                background: #f7f7f7;
                padding: 15px;
                border-radius: 8px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
                background: #fff;
            }

            th, td {
                padding: 12px;
                text-align: left;
            }

            th {
                background-color: #ecf0f1;
                font-weight: bold;
            }

            tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            .btn-action {
                padding: 6px 12px;
                border-radius: 6px;
                border: none;
                cursor: pointer;
                transition: 0.3s;
            }

            .btn-edit {
                background-color: #f39c12;
                color: white;
            }

            .btn-remove {
                background-color: #e74c3c;
                color: white;
            }
        </style>

        <div rendered="#{loginBean.usuarioLogado.logado and loginBean.usuarioLogado != null}">

            <h1 class="page-title">ðŸŽ¶ Gerenciar MÃºsicas</h1>

            <ui:fragment rendered="#{empty bandaBean.listarBandas()}">
                <div class="warning-box">
                    âš  Nenhuma banda cadastrada!  
                    VocÃª precisa cadastrar pelo menos uma banda antes de adicionar mÃºsicas.
                    <br/><br/>
                    <h:form>
                        <h:commandButton value="Cadastrar Banda"
                                         action="CadastrarBandaJSF.xhtml?faces-redirect=true"
                                         styleClass="btn-primary" />
                    </h:form>
                </div>
            </ui:fragment>

            <ui:fragment rendered="#{empty generoBean.listarGeneros()}">
                <div class="warning-box">
                    âš  Nenhum gÃªnero cadastrado!  
                    Cadastre um gÃªnero para continuar.
                    <br/><br/>
                    <h:form>
                        <h:commandButton value="Cadastrar GÃªnero"
                                         action="CadastroGenerosJSF.xhtml?faces-redirect=true"
                                         styleClass="btn-primary" />
                    </h:form>
                </div>
            </ui:fragment>

            <ui:fragment rendered="#{not empty bandaBean.listarBandas() and not empty generoBean.listarGeneros()}">

                <h:form>
                    <h:commandButton value="Cadastrar Nova MÃºsica"
                                     styleClass="btn-primary"
                                     action="#{musicaBean.irParaPaginaDeCadastroDeMusica()}" />
                </h:form>

            </ui:fragment>

            <h2 class="section-title">Buscar MÃºsicas</h2>

            <h:form>
                <h:panelGrid columns="3" styleClass="search-grid">
                    <h:outputLabel value="Nome:" />

                    <h:inputText value="#{musicaBean.nome}"
                                 style="padding:6px; border-radius:6px; border:1px solid #ccc;">
                        <f:ajax event="keyup"
                                render="tabela"
                                listener="#{musicaBean.filtrarPorNome}" />
                    </h:inputText>

                    <h:commandButton value="Buscar"
                                     styleClass="btn-primary"
                                     action="#{musicaBean.filtrarPorNome}" />
                </h:panelGrid>
            </h:form>

            <h:dataTable id="tabela"
                         value="#{musicaBean.listaFiltradaPorNome}"
                         var="m">

                <h:column>
                    <f:facet name="header">Nome</f:facet>
                    <h:outputText value="#{m.nome}" />
                </h:column>

                <h:column>
                    <f:facet name="header">GÃªnero</f:facet>
                    <h:outputText value="#{m.genero.nome}" />
                </h:column>

                <h:column>
                    <f:facet name="header">Banda</f:facet>
                    <h:outputText value="#{m.banda.nome}" />
                </h:column>

                <h:column rendered="#{loginBean.usuarioLogado.adm}">
                    <f:facet name="header">Editar</f:facet>
                    <h:form>
                        <h:commandButton value="Editar"
                                         styleClass="btn-action btn-edit"
                                         action="#{musicaBean.irParaPaginaDeEdicao(m)}" />
                    </h:form>
                </h:column>

                <h:column rendered="#{loginBean.usuarioLogado.adm}">
                    <f:facet name="header">Remover</f:facet>
                    <h:form>
                        <h:commandButton value="Remover"
                                         styleClass="btn-action btn-remove"
                                         action="#{musicaBean.removerMusica(m)}"
                                         onclick="return confirm('Tem certeza que deseja remover esta mÃºsica?')" />
                    </h:form>
                </h:column>

            </h:dataTable>

        </div>

    </ui:define>

</ui:composition>
